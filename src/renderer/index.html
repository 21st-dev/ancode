<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com; style-src 'self' 'unsafe-inline'; connect-src 'self' ws://localhost:* http://localhost:* https://unpkg.com; img-src 'self' data: blob: https:; media-src 'self' blob:;" />
    <title>2code</title>
    <!-- Prevent theme flash: detect system/stored theme before render -->
    <script>
      (function() {
        var stored = localStorage.getItem('theme');
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored === 'light' ? 'light' : stored === 'dark' ? 'dark' : (prefersDark ? 'dark' : 'light');
        document.documentElement.classList.add(theme);
      })();
    </script>
    <style>
      /* Loading state before React loads - respects system theme */
      :root {
        --loading-bg: #ffffff;
        --loading-text: #09090b;
        --loading-logo: #a1a1aa;
      }
      .dark {
        --loading-bg: #09090b;
        --loading-text: #fafafa;
        --loading-logo: #71717a;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        background: var(--loading-bg);
        color: var(--loading-text);
      }
      /* Loading container - hidden when React renders */
      .loading-container {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--loading-bg);
        z-index: 9999;
        transition: opacity 150ms ease-out;
      }
      /* Hide loading when root has content */
      #root:not(:empty) + .loading-container,
      #root:not(:empty) ~ .loading-container {
        opacity: 0;
        pointer-events: none;
      }
      .loading-logo {
        width: 24px;
        height: 24px;
        animation: pulse 1.5s ease-in-out infinite;
      }
      .loading-logo path {
        fill: var(--loading-logo);
      }
      @keyframes pulse {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.6; }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <!-- Loading indicator - separate from root so :empty works -->
    <div class="loading-container">
      <svg class="loading-logo" viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- Stylized "2" with integrated code brackets for 2code -->
        <path d="M70 110C70 70.2355 102.235 38 142 38H258C297.765 38 330 70.2355 330 110V150C330 169.882 313.882 186 294 186H150L294 318H330C349.882 318 366 334.118 366 354H70V318H230L110 186V150C110 130.118 126.118 114 146 114H254C273.882 114 290 97.8823 290 78H146C126.118 78 110 94.1177 110 114H70Z" fill="var(--loading-logo)"/>
        <!-- Opening bracket < -->
        <path d="M34 200L88 148V176L58 200L88 224V252L34 200Z" fill="var(--loading-logo)" opacity="0.7"/>
        <!-- Closing bracket > -->
        <path d="M366 200L312 148V176L342 200L312 224V252L366 200Z" fill="var(--loading-logo)" opacity="0.7"/>
      </svg>
    </div>
    <script>
      console.log("[HTML] Inline script running - scripts work!");
      window.onerror = function(msg, url, line) {
        console.error("[HTML] Global error:", msg, "at", url, "line", line);
        document.getElementById("root").innerHTML = "<pre style='color:red;padding:20px'>Error: " + msg + "</pre>";
      };
    </script>
    <script type="module" src="./main.tsx"></script>
  </body>
</html>
